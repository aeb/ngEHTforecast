

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fisher.ff_models &mdash; ngEHTforecast 0+untagged.70.g61b689c.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/ngeht_construction.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ngEHTforecast 0+untagged.70.g61b689c.dirty documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../docs/src/index.html" class="icon icon-home"> ngEHTforecast
          

          
            
            <img src="../../_static/ngeht_construction.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0+untagged.70.g61b689c.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/userguide.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/devel.html">Developer’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../docs/src/index.html">ngEHTforecast</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../docs/src/index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>fisher.ff_models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fisher.ff_models</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">ss</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">si</span>
<span class="kn">import</span> <span class="nn">ehtim</span> <span class="k">as</span> <span class="nn">eh</span>

<span class="kn">import</span> <span class="nn">ngEHTforecast.fisher.fisher_forecast</span> <span class="k">as</span> <span class="nn">ff</span>

<span class="c1"># Some constants</span>
<span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>            
<span class="n">rad2uas</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">uas2rad</span><span class="p">)</span>
<span class="n">sig2fwhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="n">fwhm2sig</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">sig2fwhm</span>

<div class="viewcode-block" id="FF_model_image"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_model_image">[docs]</a><span class="k">class</span> <span class="nc">FF_model_image</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast from ThemisyPy model_image objects. Uses FFTs and centered </span>
<span class="sd">    finite-difference to compute the visibilities and gradients. May not always</span>
<span class="sd">    produce sensible behaviors. Has not been extensively tested for some time.</span>

<span class="sd">    Args:</span>
<span class="sd">      img (model_image): A ThemisPy model_image object.</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      img (model_image): The ThemisPy model_image object for which to make forecasts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>

<div class="viewcode-block" id="FF_model_image.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_model_image.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a given model image object.  Note </span>
<span class="sd">        that this uses FFTs to create the visibilities and then interpolates.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          limits (list): May be single number, list with four elements specifying in :math:`\\mu as` the symmetric limits or explicit limits in [xmin,xmax,ymin,ymax] order.  Default: 100.</span>
<span class="sd">          shape (list): May be single number or list with two elements indicating the number of pixels in the two directions.  Default: 256.</span>
<span class="sd">          padding (int): Factor by which to pad image with zeros prior to FFT.  Default: 4.</span>
<span class="sd">          verbosity (int): Verbosity level. 0 prints nothing. 1 prints various elements of the plotting process. Passed to :func:`model_image.generate_intensity_map`. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_model_image are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="c1"># Generate the image at current location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># Fix image limits</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">]</span>

        <span class="c1"># Set shape</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;limits:&quot;</span><span class="p">,</span><span class="n">limits</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shape:&quot;</span><span class="p">,</span><span class="n">shape</span><span class="p">)</span>
            
        <span class="c1"># Generate a set of pixels</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
        <span class="c1"># Generate a set of intensities (Jy/uas^2)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">V00_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>

        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">uas2rad</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">uas2rad</span>
        
        <span class="c1"># Generate the complex visibilities, gridded</span>
        <span class="n">V2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">padding</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">))))</span>
        <span class="n">u1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">padding</span><span class="o">*</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">v1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">padding</span><span class="o">*</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
        
        <span class="c1"># Center image</span>
        <span class="n">i2d</span><span class="p">,</span><span class="n">j2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">V2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">V2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">V2d</span> <span class="o">=</span> <span class="n">V2d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">i2d</span><span class="o">+</span><span class="n">j2d</span><span class="p">))</span>
        
        
        <span class="c1"># Generate the interpolator and interpolate to the u,v list</span>
        <span class="n">Vrinterp</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">u1d</span><span class="p">,</span><span class="n">v1d</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V2d</span><span class="p">))</span>
        <span class="n">Viinterp</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">u1d</span><span class="p">,</span><span class="n">v1d</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V2d</span><span class="p">))</span>

        <span class="n">V00_fft</span> <span class="o">=</span> <span class="n">Vrinterp</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">V2d</span> <span class="o">=</span> <span class="n">V2d</span> <span class="o">*</span> <span class="n">V00_img</span><span class="o">/</span><span class="n">V00_fft</span>
        
        <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">u</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vrinterp</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">Viinterp</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">V</span></div>
            
<div class="viewcode-block" id="FF_model_image.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_model_image.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a given model image object.  Note </span>
<span class="sd">        that this uses FFTs to create the visibilities and then interpolates.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          h (float): fractional step for finite-difference gradient computation.  Default: 0.01.</span>
<span class="sd">          limits (list): May be single number, list with four elements specifying in :math:`\\mu as` the symmetric limits or explicit limits in [xmin,xmax,ymin,ymax] order.  Default: 100.</span>
<span class="sd">          shape (list): May be single number or list with two elements indicating the number of pixels in the two directions.  Default: 256.</span>
<span class="sd">          padding (int): Factor by which to pad image with zeros prior to FFT.  Default: 4.</span>
<span class="sd">          verbosity (int): Verbosity level. 0 prints nothing. 1 prints various elements of the plotting process. Passed to :func:`model_image.generate_intensity_map`. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities gradients computed at observation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_model_image are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">hq</span> <span class="o">=</span> <span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">hq</span> <span class="o">=</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">hq</span>
            <span class="n">Vmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">pp</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">))</span>
            <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">hq</span>
            <span class="n">Vmm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">pp</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">))</span>
            <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">gradV</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vmp</span><span class="o">-</span><span class="n">Vmm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">hq</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gradV</span></div>

<div class="viewcode-block" id="FF_model_image.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_model_image.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">parameter_name_list</span><span class="p">()</span></div></div>
    

<div class="viewcode-block" id="FF_smoothed_delta_ring"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring">[docs]</a><span class="k">class</span> <span class="nc">FF_smoothed_delta_ring</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a delta-ring convolved with a circular Gaussian.</span>
<span class="sd">    Parameter vector is:</span>

<span class="sd">    * p[0] ... Total flux in Jy.</span>
<span class="sd">    * p[1] ... Diameter in uas.</span>
<span class="sd">    * p[2] ... Twice the standard deviation of the Gaussian smoothing kernel in uas.</span>

<span class="sd">    Args:</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        
<div class="viewcode-block" id="FF_smoothed_delta_ring.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>
        <span class="c1">#  p[2] ... width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_smoothed_delta_ring are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">J0</span> <span class="o">*</span> <span class="n">ey2</span>
        <span class="k">return</span> <span class="n">V</span></div>
        
<div class="viewcode-block" id="FF_smoothed_delta_ring.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>
        <span class="c1">#  p[2] ... width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_smoothed_delta_ring are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
                
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">J0</span><span class="o">*</span><span class="n">ey2</span><span class="p">,</span>  <span class="c1"># dV/dp[0]</span>
                           <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">*</span><span class="n">J1</span><span class="o">*</span><span class="n">ey2</span><span class="p">,</span> <span class="c1"># dV/dd</span>
                           <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">J0</span><span class="o">*</span><span class="n">ey2</span> <span class="p">])</span> <span class="c1"># dV/dw</span>

        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>
        

<div class="viewcode-block" id="FF_smoothed_delta_ring.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta d~(\mu{\rm as})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta w~(\mu{\rm as})$&#39;</span><span class="p">]</span></div></div>
    

<div class="viewcode-block" id="FF_symmetric_gaussian"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_symmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">FF_symmetric_gaussian</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a circular Gaussian.</span>
<span class="sd">    Parameter vector is:</span>

<span class="sd">    * p[0] ... Total flux in Jy.</span>
<span class="sd">    * p[1] ... FWHM in uas.</span>

<span class="sd">    Args:</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        
<div class="viewcode-block" id="FF_symmetric_gaussian.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_symmetric_gaussian.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a circular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_symmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ey2</span></div>
        
<div class="viewcode-block" id="FF_symmetric_gaussian.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_symmetric_gaussian.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with a circular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... diameter in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_symmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">ey2</span><span class="p">,</span> <span class="c1"># dV/dp[0]</span>
                           <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">ey2</span> <span class="p">])</span> <span class="c1"># dV/dd</span>

        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>
        

<div class="viewcode-block" id="FF_symmetric_gaussian.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_symmetric_gaussian.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta FWHM~(\mu{\rm as})$&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="FF_asymmetric_gaussian"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_asymmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">FF_asymmetric_gaussian</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a noncircular Gaussian.  </span>
<span class="sd">    Parameter vector is:</span>

<span class="sd">    * p[0] ... Total flux in Jy.</span>
<span class="sd">    * p[1] ... Symmetrized mean of the FHWM in the major and minor axes in uas: :math:`{\\rm FWHM}^{-2} = {\\rm FMHM}_{\\rm min}^{-2}+{\\rm FWHM}_{\\rm max}^{-2}`</span>
<span class="sd">    * p[2] ... Asymmetry parameter, :math:`A`, expected to be in the range [0,1).</span>
<span class="sd">    * p[3] ... Position angle in radians.</span>

<span class="sd">    In terms of these, :math:`{\\rm FWHM}_{\\rm maj}={\\rm FWHM}/\\sqrt{1-A}` and :math:`{\\rm FWHM}_{\\rm min}={\\rm FWHM}/\\sqrt{1-A}`.</span>

<span class="sd">    Args:</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        
<div class="viewcode-block" id="FF_asymmetric_gaussian.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_asymmetric_gaussian.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a noncircular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... mean diameter in uas</span>
        <span class="c1">#  p[2] ... asymmetry parameter </span>
        <span class="c1">#  p[3] ... position angle in radians</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_asymmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>
        
        <span class="n">F</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">uas2rad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">cpa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">spa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ur</span> <span class="o">=</span> <span class="n">cpa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">spa</span><span class="o">*</span><span class="n">v</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="o">-</span><span class="n">spa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">cpa</span><span class="o">*</span><span class="n">v</span>

        <span class="n">sigmaj</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">)</span>
        <span class="n">sigmin</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">)</span>

        <span class="n">pimaj</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ur</span>
        <span class="n">pimin</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">vr</span>

        <span class="n">ymaj</span> <span class="o">=</span> <span class="n">pimaj</span><span class="o">*</span><span class="n">sigmaj</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">pimin</span><span class="o">*</span><span class="n">sigmin</span>

        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ymaj</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ymin</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">F</span><span class="o">*</span><span class="n">ey2</span></div>

    
<div class="viewcode-block" id="FF_asymmetric_gaussian.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_asymmetric_gaussian.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with a noncircular Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... flux in Jy</span>
        <span class="c1">#  p[1] ... mean diameter in uas</span>
        <span class="c1">#  p[2] ... asymmetry parameter </span>
        <span class="c1">#  p[3] ... position angle in radians</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_asymmetric_gaussian are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="c1"># uas2rad_fwhm2sig = np.pi/180./3600e6 / np.sqrt(8.0*np.log(2.0))</span>
        
        <span class="n">F</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">cpa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">spa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ur</span> <span class="o">=</span> <span class="n">cpa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">spa</span><span class="o">*</span><span class="n">v</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="o">-</span><span class="n">spa</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">cpa</span><span class="o">*</span><span class="n">v</span>

        <span class="n">sigmaj</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">)</span>
        <span class="n">sigmin</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">)</span>

        <span class="n">pimaj</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ur</span> <span class="o">*</span> <span class="n">uas2rad</span><span class="o">*</span><span class="n">fwhm2sig</span> 
        <span class="n">pimin</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">vr</span> <span class="o">*</span> <span class="n">uas2rad</span><span class="o">*</span><span class="n">fwhm2sig</span> 

        <span class="n">ymaj</span> <span class="o">=</span> <span class="n">pimaj</span><span class="o">*</span><span class="n">sigmaj</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">pimin</span><span class="o">*</span><span class="n">sigmin</span>

        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ymaj</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ymin</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">ey2</span><span class="p">,</span> <span class="c1"># dV/dF</span>
                           <span class="o">-</span><span class="n">F</span><span class="o">*</span><span class="n">ey2</span><span class="o">*</span><span class="p">(</span> <span class="n">pimaj</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">pimin</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">)</span> <span class="p">),</span> <span class="c1"># dV/dd</span>
                           <span class="o">-</span><span class="n">F</span><span class="o">*</span><span class="n">ey2</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">pimaj</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">pimin</span><span class="o">*</span><span class="n">sig</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">),</span> <span class="c1"># dV/dA</span>
                           <span class="o">-</span><span class="n">F</span><span class="o">*</span><span class="n">ey2</span><span class="o">*</span> <span class="n">pimaj</span><span class="o">*</span><span class="n">pimin</span> <span class="o">*</span> <span class="p">(</span> <span class="n">sigmaj</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sigmin</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">])</span>
        
        
        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="FF_asymmetric_gaussian.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_asymmetric_gaussian.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta FWHM~(\mu{\rm as})$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta A$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm PA}~({\rm rad})$&#39;</span><span class="p">]</span></div></div>

    

<div class="viewcode-block" id="W_cubic_spline_1d"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.W_cubic_spline_1d">[docs]</a><span class="k">def</span> <span class="nf">W_cubic_spline_1d</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fourier domain convolution function for the approximate 1D cubic spline.</span>
<span class="sd">    Useful for the splined raster image classes.</span>

<span class="sd">    Args:</span>
<span class="sd">      k (numpy.ndarray): Wavenumber.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 1D array of values of the cubic spline weight function evaluated at each value of k.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">abk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">ok4</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">abk</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">ok3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">abk</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-2</span><span class="p">,</span>
                     <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="mi">16</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">560.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span>
                     <span class="p">(</span> <span class="mf">12.0</span><span class="o">*</span><span class="n">ok4</span><span class="o">*</span><span class="p">(</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="p">)</span>
                       <span class="o">-</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">ok3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>

    
<div class="viewcode-block" id="FF_splined_raster"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_splined_raster">[docs]</a><span class="k">class</span> <span class="nc">FF_splined_raster</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a splined raster (i.e., themage).</span>
<span class="sd">    Parameter vector is the log of the intensity at the control points:</span>

<span class="sd">    * p[0] ....... :math:`\\ln(I[0,0])`</span>
<span class="sd">    * p[1] ....... :math:`\\ln(I[1,0])`</span>
<span class="sd">    * ...</span>
<span class="sd">    * p[N-1] ..... :math:`\\ln(I[N-1,0])`</span>
<span class="sd">    * p[N] ....... :math:`\\ln(I[0,1])`</span>
<span class="sd">    * ...</span>
<span class="sd">    * p[N*N-1] ... :math:`\\ln(I[N-1,N-1])`</span>

<span class="sd">    where each :math:`I[i,j]` is measured in Jy/sr.</span>

<span class="sd">    Args:</span>
<span class="sd">      N (int): Raster dimension (only supports square raster).</span>
<span class="sd">      fov (float): Raster field of view in uas (only supports fixed rasters).</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      xcp (numpy.ndarray): x-positions of raster control points.</span>
<span class="sd">      ycp (numpy.ndarray): y-positions of raster control points.</span>
<span class="sd">      apx (float): Raster pixel size.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">fov</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npx</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># fov = fov * np.pi/(3600e6*180) * (N-1)/N</span>
        <span class="n">fov</span> <span class="o">=</span> <span class="n">fov</span> <span class="o">*</span> <span class="n">uas2rad</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*=</span> <span class="mi">4</span>

<div class="viewcode-block" id="FF_splined_raster.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_splined_raster.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with a splined raster model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_splined_raster are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        
        <span class="c1"># Add themage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
            <span class="k">return</span> <span class="n">V</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="n">U</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>
            <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>

            <span class="n">countI</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
                    <span class="n">countI</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
                    <span class="n">U</span> <span class="o">=</span> <span class="n">U</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>

            <span class="n">RR</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">V</span>
            <span class="n">LL</span> <span class="o">=</span> <span class="n">I</span> <span class="o">-</span> <span class="n">V</span>
            <span class="n">RL</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">U</span>
            <span class="n">LR</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">U</span>

            <span class="k">return</span> <span class="n">RR</span><span class="p">,</span> <span class="n">LL</span><span class="p">,</span> <span class="n">RL</span><span class="p">,</span> <span class="n">LR</span></div>
        
<div class="viewcode-block" id="FF_splined_raster.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_splined_raster.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with a splined raster model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_splined_raster are not yet implemented!&#39;</span><span class="p">))</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        
        <span class="c1"># Add themage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gradI</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">gradQ</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">gradU</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            
            <span class="n">countI</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">gradI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
                    <span class="n">countI</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">gradQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
                    <span class="n">gradU</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
                    <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">countI</span> <span class="o">+</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
            <span class="n">gradI_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradI</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradQ_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradQ</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradU_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradU</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">gradV_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="n">gradI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>
            <span class="n">gradQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>
            <span class="n">gradU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>
            <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">block</span><span class="p">([</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradI_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradQ_small</span><span class="p">,</span><span class="mf">0.0</span><span class="o">*</span><span class="n">gradU_small</span><span class="p">,</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gradV_small</span><span class="p">])</span>

            <span class="n">grad_RR</span> <span class="o">=</span> <span class="n">gradI</span> <span class="o">+</span> <span class="n">gradV</span>
            <span class="n">grad_LL</span> <span class="o">=</span> <span class="n">gradI</span> <span class="o">-</span> <span class="n">gradV</span>
            <span class="n">grad_RL</span> <span class="o">=</span> <span class="n">gradQ</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">gradU</span>
            <span class="n">grad_LR</span> <span class="o">=</span> <span class="n">gradQ</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">gradU</span>
            
            <span class="k">return</span> <span class="n">grad_RR</span><span class="p">,</span> <span class="n">grad_LL</span><span class="p">,</span> <span class="n">grad_RL</span><span class="p">,</span> <span class="n">grad_LR</span></div>


<div class="viewcode-block" id="FF_splined_raster.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_splined_raster.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">pll</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta I_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta Q_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta U_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta V_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">pll</span></div>

<div class="viewcode-block" id="FF_splined_raster.generate_parameter_list"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_splined_raster.generate_parameter_list">[docs]</a>    <span class="k">def</span> <span class="nf">generate_parameter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">glob</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility function to quickly and easily generate a set of raster values</span>
<span class="sd">        associated with various potential initialization schemes. These include:</span>
<span class="sd">        an existing FisherForecast object, a FisherForecast class, or a FITS file</span>
<span class="sd">        name.</span>

<span class="sd">        TBD.</span>

<span class="sd">        Args:</span>
<span class="sd">          glob (str): Can be an existing FisherForecast child object, the name of a FisherForecast child class, or a string with a FITS file name.</span>
<span class="sd">          p (list): If glob is a FisherForecast child object or the name of a FisherForecast child class, a parameter list must be passed from which the image will be generated.</span>
<span class="sd">          </span>
<span class="sd">        Returns:</span>
<span class="sd">          p (list): Approximate parameter list for associated splined raster object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">glob</span><span class="p">),</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="c1"># This is a FF object, set the parameters, make the images and go</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="p">(</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">glob</span><span class="p">,</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="c1"># This is a FF class, create a FF obj set the parameters, make the images and go</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glob</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="c1"># This is a string, check for .fits and go</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized glob from which to generate acceptable parameter list.&quot;</span><span class="p">))</span>                  
        
        <span class="k">pass</span></div></div>


    

<div class="viewcode-block" id="FF_smoothed_delta_ring_themage"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring_themage">[docs]</a><span class="k">class</span> <span class="nc">FF_smoothed_delta_ring_themage</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for a splined raster (i.e., themage) plus a</span>
<span class="sd">    Gaussian-convolved delta-ring.</span>

<span class="sd">    Parameter vector is the log of the intensity at the control points:</span>

<span class="sd">    * p[0] ....... :math:`\\ln(I[0,0])`</span>
<span class="sd">    * p[1] ....... :math:`\\ln(I[1,0])`</span>
<span class="sd">    * ...</span>
<span class="sd">    * p[N-1] ..... :math:`\\ln(I[N-1,0])`</span>
<span class="sd">    * p[N] ....... :math:`\\ln(I[0,1])`</span>
<span class="sd">    * ...</span>
<span class="sd">    * p[N*N-1] ... :math:`\\ln(I[N-1,N-1])`</span>
<span class="sd">    * p[N*N+0] ... Total flux in Jy.</span>
<span class="sd">    * p[N*N+1] ... Diameter in uas.</span>
<span class="sd">    * p[N*N+2] ... Twice the standard deviation of the Gaussian smoothing kernel in uas.</span>

<span class="sd">    where each :math:`I[i,j]` is measured in Jy/sr.</span>

<span class="sd">    Args:</span>
<span class="sd">      N (int): Raster dimension (only supports square raster).</span>
<span class="sd">      fov (float): Raster field of view in uas (only supports fixed rasters).</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      xcp (numpy.ndarray): x-positions of raster control points.</span>
<span class="sd">      ycp (numpy.ndarray): y-positions of raster control points.</span>
<span class="sd">      apx (float): Raster pixel size.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">fov</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npx</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="n">fov</span> <span class="o">=</span> <span class="n">fov</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">3600e6</span><span class="o">*</span><span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fov</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>

<div class="viewcode-block" id="FF_smoothed_delta_ring_themage.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring_themage.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with splined raster + Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>
        <span class="c1">#  p[NxN+0] ... ring flux in Jy</span>
        <span class="c1">#  p[NxN+1] ... ring diameter in uas</span>
        <span class="c1">#  p[NxN+2] ... ring width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized visibilities for FF_smoothed_delta_ring_themage are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">V</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">j</span><span class="o">*</span><span class="n">u</span>

        <span class="c1"># print(&quot;p:&quot;,p)</span>
        
        <span class="c1"># Add themage</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span>

        <span class="c1"># print(u[:5],v[:5],V[:5])</span>

                
        <span class="c1"># Add ring</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># uas2rad = np.pi/180./3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">J0</span> <span class="o">*</span> <span class="n">ey2</span>
        
        <span class="k">return</span> <span class="n">V</span></div>
        
<div class="viewcode-block" id="FF_smoothed_delta_ring_themage.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring_themage.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with splined-raster + Gaussian-convolved delta-ring.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1">#  p[0] ... p[0,0]</span>
        <span class="c1">#  p[1] ... p[1,0]</span>
        <span class="c1">#  ...</span>
        <span class="c1">#  p[NxN-1] = p[N-1,N-1]</span>
        <span class="c1">#  p[NxN+0] ... ring flux in Jy</span>
        <span class="c1">#  p[NxN+1] ... ring diameter in uas</span>
        <span class="c1">#  p[NxN+2] ... ring width in uas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polarized gradients for FF_smoothed_delta_ring_themage are not yet implemented!&#39;</span><span class="p">))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add themage</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="o">*</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ycp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">apx</span> <span class="p">)</span>
        
        <span class="c1"># Add ring</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># uas2rad = np.pi/180./3600e6</span>
        <span class="n">piuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">uas2rad</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">d</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">piuv</span><span class="o">*</span><span class="n">w</span>
        <span class="n">J0</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">J1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">J0</span><span class="o">*</span><span class="n">ey2</span> <span class="p">)</span> <span class="c1"># dV/dF</span>
        <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">*</span><span class="n">J1</span><span class="o">*</span><span class="n">ey2</span> <span class="p">)</span> <span class="c1"># dV/dd</span>
        <span class="n">gradV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">piuv</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">J0</span><span class="o">*</span><span class="n">ey2</span> <span class="p">)</span> <span class="c1"># dV/dw</span>

        <span class="n">gradV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV</span><span class="p">)</span>
        
        <span class="c1"># print(&quot;FOO:&quot;,gradV.shape)</span>
        
        <span class="k">return</span> <span class="n">gradV</span><span class="o">.</span><span class="n">T</span></div>
        

<div class="viewcode-block" id="FF_smoothed_delta_ring_themage.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_smoothed_delta_ring_themage.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">pll</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npx</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\delta I_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">)</span>
        <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta d~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="n">pll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta w~(\mu{\rm as})$&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pll</span></div></div>

    
<div class="viewcode-block" id="FF_thick_mring"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_thick_mring">[docs]</a><span class="k">class</span> <span class="nc">FF_thick_mring</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">FisherForecast</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FisherForecast object for an m-ring model (based on ehtim).</span>
<span class="sd">    Parameter vector is:</span>

<span class="sd">    * p[0] ... DOM, PLEASE FILL THIS IN.</span>

<span class="sd">    Args:</span>
<span class="sd">      m (int): Stokes I azimuthal Fourier series order.</span>
<span class="sd">      mp (int): Linear polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;. Default: None.</span>
<span class="sd">      mc (int): Circular polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;. Default: None.</span>
<span class="sd">      stokes (str): Indicates if this is limited to Stokes I (&#39;I&#39;) or include full polarization (&#39;full&#39;). Default: &#39;I&#39;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      m (int): Stokes I azimuthal Fourier series order.</span>
<span class="sd">      mp (int): Linear polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;.</span>
<span class="sd">      mc (int): Circular polarization azimuthal Fourier series order. Only used if stokes==&#39;full&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">mp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">=</span> <span class="n">mp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="n">stokes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span>

<div class="viewcode-block" id="FF_thick_mring.param_wrapper"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_thick_mring.param_wrapper">[docs]</a>    <span class="k">def</span> <span class="nf">param_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts parameters from a flattened list to an ehtim-style dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          p (float): Parameter list as used by FisherForecast.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">          (dict): Dictionary containing parameter values as used by ehtim.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># convert unwrapped parameter list to ehtim-readable version</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;F0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">beta_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>
        <span class="n">ind_start</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="n">beta_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)])</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_list</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">beta_list_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>
                <span class="n">ind_start</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">beta_list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">):</span>
                    <span class="n">beta_list_pol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)])</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_pol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_list_pol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_pol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">beta_list_cpol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>
                <span class="n">ind_start</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">beta_list_pol</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">):</span>
                    <span class="n">beta_list_cpol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">ind_start</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)])</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_cpol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_list_cpol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;beta_list_cpol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="FF_thick_mring.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_thick_mring.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibilities associated with m-ring model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Takes:</span>
        <span class="c1"># p[0] ... total flux of the ring (Jy), which is also beta_0.</span>
        <span class="c1"># p[1] ... ring diameter (radians)</span>
        <span class="c1"># p[2] ... ring thickness (FWHM of Gaussian convolution) (radians)</span>
        <span class="c1"># p[...] ... beta list; list of complex Fourier coefficients, [beta_1, beta_2, ..., beta_m]</span>
        <span class="c1">#          Negative indices are determined by the condition beta_{-m} = beta_m*.</span>
        <span class="c1">#          Indices are all scaled by F0 = beta_0, so they are dimensionless.</span>
        <span class="c1"># p[...] ... beta list for linear polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mp}, beta_{-mp+1}, ..., beta_{mp-1}, beta_{mp}]</span>
        <span class="c1"># p[...] ... beta list for circular polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mc}, beta_{-mc+1}, ..., beta_{mc-1}, beta_{mc}]</span>

        <span class="c1"># set up parameter dictionary for ehtim</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_wrapper</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># read (u,v)-coordinates</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="c1"># compute model visibilities</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">vis</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">vis</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vis_RR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RR&#39;</span><span class="p">)</span>
            <span class="n">vis_LL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LL&#39;</span><span class="p">)</span>
            <span class="n">vis_RL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RL&#39;</span><span class="p">)</span>
            <span class="n">vis_LR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">vis_RR</span><span class="p">,</span> <span class="n">vis_LL</span><span class="p">,</span> <span class="n">vis_RL</span><span class="p">,</span> <span class="n">vis_LR</span></div>
        
<div class="viewcode-block" id="FF_thick_mring.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_thick_mring.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates visibility gradients associated with m-ring model.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.Obsdata): ehtim data object</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Takes:</span>
        <span class="c1"># p[0] ... total flux of the ring (Jy), which is also beta_0.</span>
        <span class="c1"># p[1] ... ring diameter (radians)</span>
        <span class="c1"># p[2] ... ring thickness (FWHM of Gaussian convolution) (radians)</span>
        <span class="c1"># p[...] ... beta list; list of complex Fourier coefficients, [beta_1, beta_2, ..., beta_m]</span>
        <span class="c1">#          Negative indices are determined by the condition beta_{-m} = beta_m*.</span>
        <span class="c1">#          Indices are all scaled by F0 = beta_0, so they are dimensionless.</span>
        <span class="c1"># p[...] ... beta list for linear polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mp}, beta_{-mp+1}, ..., beta_{mp-1}, beta_{mp}]</span>
        <span class="c1"># p[...] ... beta list for circular polarization (if present)</span>
        <span class="c1">#          list of complex Fourier coefficients, [beta_{-mc}, beta_{-mc+1}, ..., beta_{mc-1}, beta_{mc}]</span>

        <span class="c1"># set up parameter dictionary for ehtim</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_wrapper</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># read (u,v)-coordinates</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>

        <span class="c1"># compute model gradients</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># unit conversion</span>
            <span class="n">grad</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="c1"># remove (x0,y0) parameters</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            
            <span class="k">return</span> <span class="n">grad</span><span class="o">.</span><span class="n">T</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">grad_RR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RR&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">grad_LL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LL&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">grad_RL</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;RL&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">grad_LR</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sample_1model_grad_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;thick_mring&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">pol</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">,</span><span class="n">fit_pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fit_cpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="c1"># unit conversion</span>
            <span class="n">grad_RR</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_RR</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="n">grad_LL</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_LL</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="n">grad_RL</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_RL</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="n">grad_LR</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>
            <span class="n">grad_LR</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">eh</span><span class="o">.</span><span class="n">RADPERUAS</span>

            <span class="c1"># remove (x0,y0) parameters</span>
            <span class="n">grad_RR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_RR</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_RR</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            <span class="n">grad_LL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_LL</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_LL</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            <span class="n">grad_RL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_RL</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_RL</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>
            <span class="n">grad_LR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">grad_LR</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grad_LR</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="p">:]))</span>

            <span class="k">return</span> <span class="n">grad_RR</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">grad_LL</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">grad_RL</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">grad_LR</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="FF_thick_mring.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.ff_models.FF_thick_mring.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta F~({\rm Jy})$&#39;</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta d~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta \alpha~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="c1"># labels.append(r&#39;$\delta x_0~(\mu{\rm as})$&#39;)</span>
        <span class="c1"># labels.append(r&#39;$\delta y_0~(\mu{\rm as})$&#39;)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{m=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{m=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">!=</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mp=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mp=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mp=0}|$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mp=0}$&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mp=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mp=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mc=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mc=-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mc=0}|$&#39;</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mc=0}$&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta |\beta_{mc=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}|$&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\delta {\rm arg}\beta_{mc=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">labels</span></div></div>
    
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Avery E. Broderick.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0+untagged.70.g61b689c.dirty',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            LINK_SUFFIX:'.html', 
            HAS_SOURCE: 'true'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>