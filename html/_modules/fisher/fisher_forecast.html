

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fisher.fisher_forecast &mdash; ngEHTforecast 1.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/ngeht_blue2.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ngEHTforecast 1.1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../docs/src/index.html" class="icon icon-home"> ngEHTforecast
          

          
            
            <img src="../../_static/ngEHTforecast_logo_transparent.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/userguide.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/devel.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/validation.html">Validation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../docs/src/index.html">ngEHTforecast</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../docs/src/index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>fisher.fisher_forecast</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fisher.fisher_forecast</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="c1"># import scipy.linalg as linalg</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">linalg</span>

<span class="k">def</span> <span class="nf">_print_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%10.3g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_print_vector</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%10.3g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_invert_matrix</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">tmp</span><span class="o">+</span><span class="n">tmp</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="c1"># return linalg.inv(a)</span>
    <span class="c1"># return linalg.pinvh(a)</span>
    <span class="c1"># n = a.shape[0]</span>
    <span class="c1"># I = np.identity(n)</span>
    <span class="c1"># return linalg.solve(a, I, sym_pos = True, overwrite_b = True)</span>

<span class="k">def</span> <span class="nf">_vMv</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span> <span class="p">:</span>
    <span class="c1"># return np.matmul(v.T,np.matmul(M,v))</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">tmp</span><span class="o">+</span><span class="n">tmp</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    
    
<span class="c1"># Some constants</span>
<span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">3600e6</span>            
<span class="n">rad2uas</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">uas2rad</span><span class="p">)</span>
<span class="n">sig2fwhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="n">fwhm2sig</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">sig2fwhm</span>    
    
<div class="viewcode-block" id="FisherForecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast">[docs]</a><span class="k">class</span> <span class="nc">FisherForecast</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that collects and contains information for making Fisher-matrix type</span>
<span class="sd">    forecasts for observations of various types.  Forms a base class for fully</span>
<span class="sd">    analytical versions that may be application specific.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      size (int): Number of parameters expected by this model.</span>
<span class="sd">      stokes (str): If this is a Stokes I model (&#39;I&#39;) or a polarized model (&#39;full&#39;).</span>
<span class="sd">      prior_sigma_list (list): List of standard deviations associated with the parameter priors.</span>
<span class="sd">      covar (numpy.ndarray): Internal space for the computation of the covariance matrix.</span>
<span class="sd">      argument_hash (str): MD5 hash object indicating last state of covariance computation. Used to determine if the covariance needs to be recomputed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="s1">&#39;purple&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_cmap_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Reds_r&#39;</span><span class="p">,</span><span class="s1">&#39;Blues_r&#39;</span><span class="p">,</span><span class="s1">&#39;Greens_r&#39;</span><span class="p">,</span><span class="s1">&#39;Oranges_r&#39;</span><span class="p">,</span><span class="s1">&#39;Purples_r&#39;</span><span class="p">]</span>

        
<div class="viewcode-block" id="FisherForecast.visibilities"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.visibilities">[docs]</a>    <span class="k">def</span> <span class="nf">visibilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User-defined function in child classes that generates visibilities </span>
<span class="sd">        associated with a given model image object.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;visibilities function not implemented in base class!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span></div>

            
<div class="viewcode-block" id="FisherForecast.visibility_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.visibility_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">visibility_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User-defined function in child classes that generates visibility gradients</span>
<span class="sd">        associated with a given model image object.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.)</span>
<span class="sd">          p (numpy.ndarray): list of parameters for the model image used to create object.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): List of complex visibilities gradients computed at observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;visibility_gradients function not implemented in base class!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">*</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="FisherForecast.parameter_labels"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.parameter_labels">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User-defined function in child classes that returns a list of</span>
<span class="sd">        of parameter labels to be used in plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list): List of strings with parameter labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;parameter_labels function not implemented in base class!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[]</span></div>

    
<div class="viewcode-block" id="FisherForecast.add_gaussian_prior"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.add_gaussian_prior">[docs]</a>    <span class="k">def</span> <span class="nf">add_gaussian_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pindex</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a Gaussian prior on the parameter with the specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">          pindex (int): Index of the parameter on which to place the prior.</span>
<span class="sd">          sigma (float): Standard deviation of the Gaussian prior to apply.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pindex</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">%i</span><span class="s2"> does not exist, expected in [0,</span><span class="si">%i</span><span class="s2">].&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">pindex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">pindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>
        
        
<div class="viewcode-block" id="FisherForecast.add_gaussian_prior_list"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.add_gaussian_prior_list">[docs]</a>    <span class="k">def</span> <span class="nf">add_gaussian_prior_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma_list</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a Gaussian priors on all of the model parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">          sigma_list (list): List of standard deviations of the Gaussian priors to apply.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sigma_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Priors must be specified for all parameters if set by list.  If sigma is None, no prior will be applied.&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="kc">None</span></div>
        

<div class="viewcode-block" id="FisherForecast.generate_image"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.generate_image">[docs]</a>    <span class="k">def</span> <span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate and return an image for the parent visibility model evaluated</span>
<span class="sd">        at a given set of parameter values.  The user is responsible for setting</span>
<span class="sd">        the plot limits and shape intelligently.  Note that this uses FFTs and </span>
<span class="sd">        assumes that the resolution and field of view are sufficient to adequately</span>
<span class="sd">        resolve model image features.</span>

<span class="sd">        Args:</span>
<span class="sd">          p (list): List of parameter values.</span>
<span class="sd">          limits (float,list): Limits on the field of view in which to construct the image in uas.  Either a single float, in which case the limits are symmetric and set to [-limits,limits,-limits,limits], or a list of floats. Default: 100.</span>
<span class="sd">          shape (int,list): Dimensions of the image.  If an int, the dimensions are equal.  If a two-element list of ints, sets the dimensions to the two values. Default: 256.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray,numpy.ndarray,numpy.ndarray): x positions of the pixel centers in uas, y positions of the pixel centers in uas, intensities at pixel centers in Jy/uas^2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Fix image limits</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">]</span>

        <span class="c1"># Set shape</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;limits:&quot;</span><span class="p">,</span><span class="n">limits</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shape:&quot;</span><span class="p">,</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">umax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">uas2rad</span><span class="o">*</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">uas2rad</span><span class="o">*</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max (u,v) = &quot;</span><span class="p">,(</span><span class="n">umax</span><span class="p">,</span><span class="n">vmax</span><span class="p">))</span>


        <span class="c1"># FIX</span>
        <span class="k">class</span> <span class="nc">obsempty</span> <span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        
        <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="n">umax</span><span class="p">:</span><span class="n">umax</span><span class="p">:(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">vmax</span><span class="p">:</span><span class="n">vmax</span><span class="p">:(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
        <span class="n">obsgrid</span> <span class="o">=</span> <span class="n">obsempty</span><span class="p">()</span>
        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>
        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obsgrid</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">V</span><span class="p">)))</span>
        <span class="n">x1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">y1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1d</span><span class="p">,</span><span class="n">y1d</span><span class="p">,</span><span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">uas2rad</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">uas2rad</span>

        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">obsgrid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obsgrid</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;V00:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obsgrid</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sum I:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span> <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span></div>

    
<div class="viewcode-block" id="FisherForecast.display_image"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.display_image">[docs]</a>    <span class="k">def</span> <span class="nf">display_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate and plot an image for the parent visibility model evaluated</span>
<span class="sd">        at a given set of parameter values.  The user is responsible for setting</span>
<span class="sd">        the plot limits and shape intelligently.  Note that this uses FFTs and </span>
<span class="sd">        assumes that the resolution and field of view are sufficient to adequately</span>
<span class="sd">        resolve model image features.</span>

<span class="sd">        Args:</span>
<span class="sd">          p (list): List of parameter values.</span>
<span class="sd">          limits (float,list): Limits on the field of view in which to construct the image in uas.  Either a single float, in which case the limits are symmetric and set to [-limits,limits,-limits,limits], or a list of floats. Default: 100.</span>
<span class="sd">          shape (int,list): Dimensions of the image.  If an int, the dimensions are equal.  If a two-element list of ints, sets the dimensions to the two values. Default: 256.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (matplotlib.pyplot.figure,matplotlib.pyplot.axes,matplotlib.pyplot.colorbar): Handles to the figure, axes, and colorbar.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">axs</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.8</span><span class="o">*</span><span class="mi">5</span><span class="o">/</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_image</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="n">Imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-1</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm Jy}/\mu{\rm as}^2)$&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-4</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm mJy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e3</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-7</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm \mu Jy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e6</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-10</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm nJy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e9</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imax</span><span class="o">&gt;</span><span class="mf">1e-13</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fu</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I~({\rm pJy}/\mu{\rm as}^2)$&#39;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="mf">1e12</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;afmhot&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta{\rm RA}~(\mu{\rm as})$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta{\rm Dec}~(\mu{\rm as})$&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
        
        <span class="n">cbax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.8</span><span class="o">*</span><span class="mi">5</span><span class="o">/</span><span class="mf">6.5</span><span class="o">+</span><span class="mf">0.05</span><span class="o">+</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="o">=</span><span class="n">cbax</span><span class="p">)</span>
        <span class="n">cbax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fu</span><span class="p">,</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axs</span><span class="p">,</span><span class="n">cbax</span></div>
        
        

<div class="viewcode-block" id="FisherForecast.check_gradients"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.check_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">check_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Numerically evaluates the gradients using the visibilities function and</span>
<span class="sd">        compares them to the gradients returned by the visibility_gradients</span>
<span class="sd">        function.  Numerical differentiation is 2nd-order, centered finite</span>
<span class="sd">        differences.  Results are output to standard out.  For best results,</span>
<span class="sd">        the user should pass some option for the step size h to use for numerical </span>
<span class="sd">        differentiation.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An ehtim Obsdata object with a particular set of observation details (u,v positions, times, etc.) at which to check gradients..</span>
<span class="sd">          p (list): List of parameter values.</span>
<span class="sd">          h (float,list): List of small steps which define the finite differences.  If None, uses 1e-4*p.  If a float, uses h*p.  If a list, sets each step size separately.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">1e-4</span><span class="p">])</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">h</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">gradV_an</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">gradV_fd</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Vp</span><span class="o">-</span><span class="n">Vm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV_fd</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gradV_an_RR</span><span class="p">,</span> <span class="n">gradV_an_LL</span><span class="p">,</span> <span class="n">gradV_an_RL</span><span class="p">,</span> <span class="n">gradV_an_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="n">gradV_an</span> <span class="o">=</span> <span class="n">gradV_an_RR</span> <span class="o">+</span> <span class="n">gradV_an_LL</span> <span class="o">+</span> <span class="n">gradV_an_RL</span> <span class="o">+</span> <span class="n">gradV_an_LR</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vp_RR</span><span class="p">,</span> <span class="n">Vp_LL</span><span class="p">,</span> <span class="n">Vp_RL</span><span class="p">,</span> <span class="n">Vp_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Vm_RR</span><span class="p">,</span> <span class="n">Vm_LL</span><span class="p">,</span> <span class="n">Vm_RL</span><span class="p">,</span> <span class="n">Vm_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilities</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">gradV_fd</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">Vp_RR</span><span class="o">-</span><span class="n">Vm_RR</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="p">((</span><span class="n">Vp_LL</span><span class="o">-</span><span class="n">Vm_LL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="p">((</span><span class="n">Vp_RL</span><span class="o">-</span><span class="n">Vm_RL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="p">((</span><span class="n">Vp_LR</span><span class="o">-</span><span class="n">Vm_LR</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">gradV_fd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradV_fd</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">lbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradV_fd</span><span class="o">-</span><span class="n">gradV_an</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gradient Check Report:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Sample of errors by parameter&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%30s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s2">&quot;Param.&quot;</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;anal. grad&quot;</span><span class="p">,</span><span class="s2">&quot;fd. grad&quot;</span><span class="p">,</span><span class="s2">&quot;err&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]),</span><span class="mi">10</span><span class="p">))</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%30s</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">lbls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">gradV_an</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">gradV_fd</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">err</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>

        <span class="n">mfe_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">mfe_i</span> <span class="o">=</span> <span class="n">mfe_arg</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="n">mfe_j</span> <span class="o">=</span> <span class="n">mfe_arg</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="n">max_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Global Maximum error:&quot;</span><span class="p">,</span><span class="n">max_err</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%30s</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2"> </span><span class="si">%15.8g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">lbls</span><span class="p">[</span><span class="n">mfe_i</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">mfe_j</span><span class="p">],</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">mfe_j</span><span class="p">],</span><span class="n">gradV_an</span><span class="p">[</span><span class="n">mfe_j</span><span class="p">][</span><span class="n">mfe_i</span><span class="p">],</span><span class="n">gradV_fd</span><span class="p">[</span><span class="n">mfe_j</span><span class="p">][</span><span class="n">mfe_i</span><span class="p">],</span><span class="n">err</span><span class="p">[</span><span class="n">mfe_j</span><span class="p">][</span><span class="n">mfe_i</span><span class="p">]))</span></div>
        

            
<div class="viewcode-block" id="FisherForecast.fisher_covar"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.fisher_covar">[docs]</a>    <span class="k">def</span> <span class="nf">fisher_covar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Fisher matrix as defined in the accompanying documentation.</span>
<span class="sd">        Intelligently avoids recomputation if the observation and parameters are</span>
<span class="sd">        unchanged.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of model parameters at which to compute the Fisher matrix.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): The Fisher matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the fisher covariance </span>
        <span class="n">new_argument_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">new_argument_hash</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">argument_hash</span> <span class="o">=</span> <span class="n">new_argument_hash</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stokes</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">switch_polrep</span><span class="p">(</span><span class="s1">&#39;stokes&#39;</span><span class="p">)</span>
                <span class="n">gradV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradV</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">gradV</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gradV</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">gradV</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">switch_polrep</span><span class="p">(</span><span class="s1">&#39;circ&#39;</span><span class="p">)</span>
                <span class="n">grad_RR</span><span class="p">,</span> <span class="n">grad_LL</span><span class="p">,</span> <span class="n">grad_RL</span><span class="p">,</span> <span class="n">grad_LR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility_gradients</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RR</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_RR</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_RR</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RR</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LL</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_LL</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;llsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_LL</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LL</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;llsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RL</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_RL</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rlsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_RL</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_RL</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rlsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LR</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_LR</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_LR</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">grad_LR</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">obs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lrsigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FisherCovar covar before priors:&quot;</span><span class="p">)</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Why factor of 2?</span>
        
            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FisherCovar covar after priors:&quot;</span><span class="p">)</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FisherCovar priors:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_sigma_list</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dimensions:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

                
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span></div>

    
<div class="viewcode-block" id="FisherForecast.uniparameter_uncertainties"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.uniparameter_uncertainties">[docs]</a>    <span class="k">def</span> <span class="nf">uniparameter_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the uncertainties on a subset of model parameters, fixing all</span>
<span class="sd">        others. Note that this is not a covariance; each uncertainty is for a </span>
<span class="sd">        single parameter, fixing all others.  This is probably not what is wanted</span>
<span class="sd">        for forecasting, see marginalized_uncertainties.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the uncertainties. If None will return a list of all uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (float/list): Parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ilist</span><span class="p">][</span><span class="n">ilist</span><span class="p">]</span>
            <span class="n">Sig_uni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">Sig_uni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ilist</span> <span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Sig_uni</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">Sig_uni</span></div>

    
<div class="viewcode-block" id="FisherForecast.marginalized_uncertainties"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.marginalized_uncertainties">[docs]</a>    <span class="k">def</span> <span class="nf">marginalized_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the uncertainties on a subset of model parameters, marginalized</span>
<span class="sd">        over all others. Note that this is not the marginalized covariance; each</span>
<span class="sd">        uncertainty is for a single parameter, marginalizing out all others.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the marginalized uncertainties. If None will return a list of all marginalized uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (float/list): Marginalized parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># M = np.zeros((self.size-1,self.size-1))</span>
        <span class="c1"># v = np.zeros(self.size-1)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">ini</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># for j2,j in enumerate(ini) :</span>
            <span class="c1">#     for k2,k in enumerate(ini) :</span>
            <span class="c1">#         M[j2,k2] = C[j][k]</span>
            <span class="c1">#     v[j2] = C[i][j]</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># Minv = _invert_matrix(M)</span>
            <span class="c1"># mN = N - np.matmul(v,np.matmul(Minv,v))</span>
            <span class="c1"># print(&quot;Before mN:&quot;,mN)</span>
            <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
            <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># mN = (N - np.matmul(v,np.matmul(Minv,v)))</span>
            <span class="n">mN</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">_vMv</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">Minv</span><span class="p">))</span>
            <span class="c1"># print(&quot;After mN:&quot;,mN)</span>
            <span class="n">Sig_marg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">Sig_marg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">))</span>
            <span class="n">iall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">ini</span> <span class="o">=</span> <span class="n">iall</span><span class="p">[</span><span class="n">iall</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># for j2,j in enumerate(ini) :</span>
                <span class="c1">#     for k2,k in enumerate(ini) :</span>
                <span class="c1">#         M[j2,k2] = C[j][k]</span>
                <span class="c1">#     v[j2] = C[i][j]</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Minv = _invert_matrix(M)</span>
                <span class="c1"># mN = N - np.matmul(v,np.matmul(Minv,v))</span>
                <span class="c1"># print(&quot;Before mN:&quot;,mN)</span>
                <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
                <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                <span class="c1"># mN = N - np.matmul(v,np.matmul(Minv,v))</span>
                <span class="n">mN</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">_vMv</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">Minv</span><span class="p">)</span>
                <span class="c1"># print(&quot;After mN:&quot;,mN)</span>
                <span class="n">Sig_marg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">Sig_marg</span></div>


<div class="viewcode-block" id="FisherForecast.marginalized_covariance"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.marginalized_covariance">[docs]</a>    <span class="k">def</span> <span class="nf">marginalized_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the covariance for a subset of model parameters, marginalized</span>
<span class="sd">        over all parameters outside of the subset.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the marginalized uncertainties. If None will return a list of all marginalized uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray): Marginalized covariance for desired parameter subset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">C</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginalized_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="n">ilist</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">iall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">isni</span> <span class="o">=</span> <span class="p">(</span><span class="n">iall</span><span class="o">!=</span><span class="n">ilist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span>
                <span class="n">isni</span> <span class="o">=</span> <span class="n">isni</span><span class="o">*</span><span class="p">(</span><span class="n">iall</span><span class="o">!=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">ini</span> <span class="o">=</span> <span class="n">iall</span><span class="p">[</span><span class="n">isni</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ilist</span><span class="p">,:][:,</span><span class="n">ilist</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ilist</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
            <span class="c1"># print(&quot;Before mN:&quot;,n - np.matmul(r.T,np.matmul(_invert_matrix(m),r)))</span>
            <span class="n">r</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
            <span class="c1"># print(&quot;After mN:&quot;,n - np.matmul(r.T,np.matmul(_invert_matrix(m),r)))</span>
            <span class="c1"># print(&quot;Shapes:&quot;,n.shape,r.shape,m.shape)</span>
            <span class="c1"># return n - np.matmul(r.T,np.matmul(_invert_matrix(m),r))</span>
            <span class="k">return</span> <span class="n">n</span> <span class="o">-</span> <span class="n">_vMv</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">_invert_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">))</span></div>
            
    
<div class="viewcode-block" id="FisherForecast.uncertainties"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.uncertainties">[docs]</a>    <span class="k">def</span> <span class="nf">uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the uncertainties on a subset of model parameters, both fixing</span>
<span class="sd">        and marginalizing over all others. </span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (int,list) : Index or list of indicies for which to compute the marginalized uncertainties. If None will return a list of all marginalized uncertainties. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (float/list,float/list): Parameter uncertainty or list of marginalized uncertainties of desired parameters, marginalized parameter uncertainty or list of marginalized uncertainties of desired parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fisher Matrix:&quot;</span><span class="p">)</span>
            <span class="n">_print_matrix</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ilist</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ilist</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">ini</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># for j2,j in enumerate(ini) :</span>
            <span class="c1">#     for k2,k in enumerate(ini) :</span>
            <span class="c1">#         M[j2,k2] = C[j][k]</span>
            <span class="c1">#     v[j2] = C[i][j]</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ini</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
            <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># mN = N - np.matmul(v,np.matmul(Minv,v))</span>
            <span class="n">mN</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">_vMv</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">Minv</span><span class="p">)</span>
            <span class="n">Sig_uni</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
            <span class="n">Sig_marg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>            
            <span class="n">Sig_uni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">Sig_marg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ilist</span> <span class="p">:</span>
                <span class="n">ini</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># for j2,j in enumerate(ini) :</span>
                <span class="c1">#     for k2,k in enumerate(ini) :</span>
                <span class="c1">#         M[j2,k2] = C[j][k]</span>
                <span class="c1">#     v[j2] = C[i][j]</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">ini</span><span class="p">,:][:,</span><span class="n">ini</span><span class="p">]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ini</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">v</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
                <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                <span class="c1"># mN = N - np.matmul(v,np.matmul(Minv,v))</span>
                <span class="n">mN</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">_vMv</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">Minv</span><span class="p">)</span>
                <span class="n">Sig_uni</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
                <span class="n">Sig_marg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mN</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submatrix (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">_print_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submatrix inverse (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>                
                    <span class="n">_print_matrix</span><span class="p">(</span><span class="n">Minv</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Subvectors v1 (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">_print_vector</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;N,mN (</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">mN</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">Sig_uni</span><span class="p">,</span><span class="n">Sig_marg</span></div>

    
<div class="viewcode-block" id="FisherForecast.joint_biparameter_chisq"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.joint_biparameter_chisq">[docs]</a>    <span class="k">def</span> <span class="nf">joint_biparameter_chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the ensemble-averaged 2nd-order contribution to the chi-square</span>
<span class="sd">        for two parameters after fixing or marginalizing over all others.</span>

<span class="sd">        Args:</span>
<span class="sd">          obs (ehtim.obsdata.Obsdata): An Obsdata object containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          i1 (int): Index of first parameter.</span>
<span class="sd">          i2 (int): Index of second parameter.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;.  Default: &#39;marginalized&#39;.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray,numpy.ndarray,numpy.ndarray): :math:`p_{i1}`, :math:`p_{i2}`, and :math:`\\chi^2` on a grid of points that covers the inner :math:`4.5\\Sigma` region.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_covar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        
        <span class="n">ini12</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[(</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ilist</span><span class="o">!=</span><span class="n">i2</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">j2</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ini12</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">k2</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ini12</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j2</span><span class="p">,</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="n">v1</span><span class="p">[</span><span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">v2</span><span class="p">[</span><span class="n">j2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i2</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>
        <span class="n">C12</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">elif</span> <span class="p">(</span><span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;marginalized&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fisher Matrix:&quot;</span><span class="p">)</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submatrix (</span><span class="si">%i</span><span class="s2">,</span><span class="si">%i</span><span class="s2">):&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">))</span>
                <span class="n">_print_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Subvectors v1:&quot;</span><span class="p">)</span>
                <span class="n">_print_vector</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Subvectors v2:&quot;</span><span class="p">)</span>
                <span class="n">_print_vector</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>

            <span class="c1"># print(&quot;i1,i2:&quot;,i1,i2)</span>
            <span class="c1"># print(v1.shape,v2.shape)</span>
            <span class="c1"># print(v1)</span>
            <span class="c1"># print(v2)</span>
            <span class="n">vv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># print(vv.shape)</span>
            <span class="c1"># print(vv)</span>
            <span class="c1"># print(vv[:,0],v1)</span>
            <span class="c1"># print(vv[:,1],v2)</span>
            <span class="c1"># print(&quot;  =================&quot;)</span>
            <span class="n">vv</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condition_vM</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># print(&quot;  =================&quot;)</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># print(v1.shape,v2.shape)</span>
            
            <span class="n">Minv</span> <span class="o">=</span> <span class="n">_invert_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># N1 = N1 - np.matmul(v1.T,np.matmul(Minv,v1))</span>
            <span class="c1"># N2 = N2 - np.matmul(v2.T,np.matmul(Minv,v2))</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">N1</span> <span class="o">-</span> <span class="n">_vMv</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">Minv</span><span class="p">)</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">N2</span> <span class="o">-</span> <span class="n">_vMv</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span><span class="n">Minv</span><span class="p">)</span>
            <span class="n">C12</span> <span class="o">=</span> <span class="n">C12</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Minv</span><span class="p">,</span><span class="n">v1</span><span class="p">)))</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Received unexpected value for kind, </span><span class="si">%s</span><span class="s2">. Allowed values are &#39;fixed&#39; and &#39;marginalized&#39;.&quot;</span><span class="p">))</span>
        
                    
        <span class="c1"># Find range with eigenvectors/values</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="n">N2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">-</span><span class="n">N2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">C12</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="n">N2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">N1</span><span class="o">-</span><span class="n">N2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">C12</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">C12</span><span class="p">,</span> <span class="n">l1</span><span class="o">-</span><span class="n">N1</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">e1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">e1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">e1</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">e1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">e1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">e2</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">e2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">e2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">l1</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">l2</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Something&#39;s wrong! Variances are nonpositive!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span><span class="n">N2</span><span class="p">,</span><span class="n">C12</span><span class="p">)</span>
            <span class="c1"># print(mN1,mN2,mC12)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

            <span class="n">l1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span><span class="n">l1</span><span class="p">)</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span><span class="n">l2</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">l1</span><span class="o">&gt;</span><span class="n">l2</span> <span class="p">):</span>
            <span class="n">Sig_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l2</span><span class="p">)</span>
            <span class="n">Sig_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l1</span><span class="p">)</span>
            <span class="n">e_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">Sig_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l1</span><span class="p">)</span>
            <span class="n">Sig_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">l2</span><span class="p">)</span>
            <span class="n">e_maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>

        <span class="n">dp1</span> <span class="o">=</span> <span class="mf">4.5</span><span class="o">*</span><span class="p">(</span> <span class="n">Sig_maj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_maj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">Sig_min</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_min</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">dp2</span> <span class="o">=</span> <span class="mf">4.5</span><span class="o">*</span><span class="p">(</span> <span class="n">Sig_maj</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_maj</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Sig_min</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_min</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>

        <span class="n">Npx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mi">16</span><span class="o">*</span><span class="n">Sig_maj</span><span class="o">/</span><span class="n">Sig_min</span><span class="p">,</span><span class="mi">1024</span><span class="p">)))</span>
        <span class="n">p1</span><span class="p">,</span><span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dp1</span><span class="p">,</span><span class="n">dp1</span><span class="p">,</span><span class="n">Npx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dp2</span><span class="p">,</span><span class="n">dp2</span><span class="p">,</span><span class="n">Npx</span><span class="p">))</span>
        <span class="n">csq</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">N1</span><span class="o">*</span><span class="n">p1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">C12</span><span class="o">*</span><span class="n">p1</span><span class="o">*</span><span class="n">p2</span> <span class="o">+</span> <span class="n">N2</span><span class="o">*</span><span class="n">p2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">csq</span></div>


<div class="viewcode-block" id="FisherForecast.plot_1d_forecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.plot_1d_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">plot_1d_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the marginalized posterior for a single parameter for a given observation.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          obs (list,Obsdata): An Obsdata object or list of Obsdata objects containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          i1 (int): Index of parameter to be plotted.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;. Default: &#39;marginalized&#39;.</span>
<span class="sd">          labels (list,str): A list of labels for each Obsdata object. When fewer labels than observations are provided, the first set of observations are labeled. Default: None.</span>
<span class="sd">          fig (matplotlib.figure.Figure): Figure on which to place plot. If None, a new figure will be created. Default: None.</span>
<span class="sd">          axes (matplotlib.axes.Axes): Axes on which to place plot. If None, a new axes will be created. Default: None.</span>
<span class="sd">          colors (list,str): A color or list of colors for the plots. When fewer colors than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          alphas (list,float): An alpha value or list of alpha values for the filled portion of the plots. Default: 0.25.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (matplotlib.figure.Figure, matplotlib.axes.Axes): Handles to the figure and axes objects in the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Label list must have the same size as the observation list.&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alphas</span><span class="p">]</span>
            

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;marginalized&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginalized_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="n">i1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniparameter_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="n">i1</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Received unexpected value for kind, </span><span class="si">%s</span><span class="s2">. Allowed values are &#39;fixed&#39; and &#39;marginalized&#39;.&quot;</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">Sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">i1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>


<div class="viewcode-block" id="FisherForecast.plot_2d_forecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.plot_2d_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">plot_2d_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmaps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the joint marginalized posterior for a pair of parameters for a given observation.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          obs (list,Obsdata): An Obsdata object or list of Obsdata objects containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          i1 (int): Index of first parameter to be plotted.</span>
<span class="sd">          i2 (int): Index of second parameter to be plotted.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;. Default: &#39;marginalized&#39;.</span>
<span class="sd">          labels (list,str): A list of labels for each Obsdata object. When fewer labels than observations are provided, the first set of observations are labeled. Default: None.</span>
<span class="sd">          fig (matplotlib.figure.Figure): Figure on which to place plot. If None, a new figure will be created. Default: None.</span>
<span class="sd">          axes (matplotlib.axes.Axes): Axes on which to place plot. If None, a new axes will be created. Default: None.</span>
<span class="sd">          colors (list,str): A color or list of colors for the plots. When fewer colors than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          cmaps (list,matplotlib.colors.Colormap): A colormap or list of colormaps for the plots. When fewer colormaps than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          alphas (list,float): An alpha value or list of alpha values for the filled portion of the plots. Default: 0.75.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (matplotlib.figure.Figure, matplotlib.axes.Axes): Handles to the figure and axes objects in the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Label list must have the same size as the observation list.&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cmaps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_cmap_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmaps</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alphas</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">d</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">csq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_biparameter_chisq</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">i1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">i2</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>


<div class="viewcode-block" id="FisherForecast.plot_triangle_forecast"><a class="viewcode-back" href="../../docs/src/fisher.html#fisher.fisher_forecast.FisherForecast.plot_triangle_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">plot_triangle_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;marginalized&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmaps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axis_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a triangle plot of joint posteriors for a selected list of parameter indexes.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">          obs (list,Obsdata): An Obsdata object or list of Obsdata objects containing the observation particulars.</span>
<span class="sd">          p (list): List of parameter values at which to compute uncertainties.</span>
<span class="sd">          ilist (list): List of indicies of parameters to include in triangle plot. If None, includes all parameters. Default: None.</span>
<span class="sd">          kind (str): Choice of what to do with other parameters. Choices are &#39;marginalized&#39;, &#39;fixed&#39;. Default: &#39;marginalized&#39;.</span>
<span class="sd">          labels (list,str): A list of labels for each Obsdata object. When fewer labels than observations are provided, the first set of observations are labeled. Default: None.</span>
<span class="sd">          colors (list,str): A color or list of colors for the plots. When fewer colors than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          cmaps (list,matplotlib.colors.Colormap): A colormap or list of colormaps for the plots. When fewer colormaps than observations are provided, they will be cycled through. If None, a default list will be used. Default: None.</span>
<span class="sd">          alphas (list,float): An alpha value or list of alpha values for the filled portion of the plots. Default: 0.75.</span>
<span class="sd">          fig (matplotlib.figure.Figure): Figure on which to place plot. If None, a new figure will be created. Default: None.</span>
<span class="sd">          axes (matplotlib.axes.Axes): Axes on which to place plot. If None, a new axes will be created. Default: None.</span>
<span class="sd">          figsize (list): Figure size in inches.  If None, attempts a guess. Default: None.</span>
<span class="sd">          axis_location (list): Location parameters for triangle plot region. If None, attempts a guess. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity level. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (matplotlib.figure.Figure, dict): Handles to the figure and dictionary of axes objects in the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ilist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ilist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Label list must have the same size as the observation list.&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_color_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cmaps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_cmap_list</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmaps</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">alphas</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span><span class="o">*</span><span class="mf">2.5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span><span class="o">*</span><span class="mf">2.5</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scf</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">plg</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">axis_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">lmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">rmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">tmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">bmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
            <span class="n">ax0</span> <span class="o">=</span> <span class="n">lmarg</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ay0</span> <span class="o">=</span> <span class="n">bmarg</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">axw</span> <span class="o">=</span> <span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">lmarg</span><span class="o">-</span><span class="n">rmarg</span><span class="p">)</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ayw</span> <span class="o">=</span> <span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tmarg</span><span class="o">-</span><span class="n">bmarg</span><span class="p">)</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">axis_location</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ay0</span><span class="p">,</span> <span class="n">axw</span><span class="p">,</span> <span class="n">ayw</span><span class="p">]</span>

        <span class="c1"># Number of rows/columns</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilist</span><span class="p">)</span>

        <span class="c1"># Make axes dictionary if it doesn&#39;t exist already</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="c1"># Get window size details</span>
            <span class="n">gutter_size</span> <span class="o">=</span> <span class="mf">0.0625</span> <span class="c1"># Gutter in inches</span>
            <span class="n">x_gutter</span> <span class="o">=</span> <span class="n">gutter_size</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_gutter</span> <span class="o">=</span> <span class="n">gutter_size</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x_window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis_location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x_gutter</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span>
            <span class="n">y_window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y_gutter</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span>
            
            <span class="n">axes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                    <span class="c1"># Find axis location with various gutters, etc.</span>
                    <span class="n">x_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">x_gutter</span><span class="o">+</span><span class="n">x_window_size</span><span class="p">)</span>
                    <span class="n">y_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_window_size</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">y_gutter</span><span class="o">+</span><span class="n">y_window_size</span><span class="p">)</span>
                    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="n">x_window_start</span><span class="p">,</span> <span class="n">y_window_start</span><span class="p">,</span> <span class="n">x_window_size</span><span class="p">,</span> <span class="n">y_window_size</span><span class="p">])</span>

        <span class="c1"># Run over panels and plot</span>
        <span class="n">xlim_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;marginalized&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginalized_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniparameter_uncertainties</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Received unexpected value for kind, </span><span class="si">%s</span><span class="s2">. Allowed values are &#39;fixed&#39; and &#39;marginalized&#39;.&quot;</span><span class="p">))</span>

            <span class="c1"># print(&quot;Sigma before:&quot;,Sigma)</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Sigma</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]))</span> <span class="p">:</span>
                    <span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="mf">999.0</span>
            <span class="c1"># print(&quot;Sigma after: &quot;,Sigma)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">jj</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mi">256</span><span class="p">)</span>
                <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xtmp</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>                        
                    <span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">&gt;</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="mf">3.5</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>                    

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">:</span>

                    <span class="c1"># ii = ilist[ni-i]</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">jj</span> <span class="o">=</span> <span class="n">ilist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>

                    <span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">csq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_biparameter_chisq</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">cmaps</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csq</span><span class="p">),</span><span class="n">colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

                    <span class="c1"># plt.text(0.05,0.05,&#39;%i,%i / %i,%i&#39;%(i,j,ii,jj),transform=plt.gca().transAxes)</span>


        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>


        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">ilist</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_labels</span><span class="p">()[</span><span class="n">ilist</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>


        <span class="c1"># Make axis for labels</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">))</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_choose_from_list</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>


        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axes</span></div>

    
    <span class="k">def</span> <span class="nf">_condition_vM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">M</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function that conditions the vector and matrix associated </span>
<span class="sd">        with marginalization.  This conditioning does not change v.M^{-1}.v,</span>
<span class="sd">        but does ensure that all quantities in the matrix multiplication</span>
<span class="sd">        and matrix inversion are of similar size.  It cannot address numerical</span>
<span class="sd">        instability caused by strongly correlated or nearly degenerate M.</span>
<span class="sd">        </span>
<span class="sd">        The components of the marginalization process assume a structure for</span>
<span class="sd">        the covariance that looks like:</span>

<span class="sd">                 ( N v.T )</span>
<span class="sd">                 ( v  M  )</span>

<span class="sd">        So, if N is an nxn array and M is an mxm array, v should be an mxn array.</span>

<span class="sd">        The conditioning procedure is equivalent to normalizing the parameters</span>
<span class="sd">        that are being marginalized by the square roots of their variances.</span>

<span class="sd">        Args:</span>
<span class="sd">          v (nd.array): Vector or matrix associated with the correlations between the parameters to be marginalized over and those to be retained.</span>
<span class="sd">          M (nd.array): Covariance of the marginalized parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (nd.array,nd.array): Conditioned v and M. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Conditions v and M to improve inversion and double-dot product performance</span>
        <span class="n">il</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">il</span><span class="p">,</span><span class="n">il</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">il</span> <span class="p">:</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">*</span><span class="n">dd</span>
            <span class="n">M</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dd</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">dd</span><span class="o">*</span><span class="n">v</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                <span class="n">v</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dd</span>

        <span class="k">return</span> <span class="n">v</span><span class="p">,</span><span class="n">M</span>

    <span class="k">def</span> <span class="nf">_choose_from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function to cyclicly select from a list.</span>

<span class="sd">        Args:</span>
<span class="sd">          v (list): A list.</span>
<span class="sd">          i (int): An integer index.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (v element type): Element of v at index i%len(v).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span></div>





<span class="c1"># if __name__ == &quot;__main__&quot; :</span>

<span class="c1">#     # Example</span>
    
<span class="c1">#     # Make Fisher forecast object</span>
<span class="c1">#     ff1 = FF_splined_raster(5,60)</span>
<span class="c1">#     ff2 = FF_smoothed_delta_ring()</span>
<span class="c1">#     ff = FF_sum([ff1,ff2])</span>

<span class="c1">#     # Read in some data</span>
<span class="c1">#     obs_ngeht = eh.obsdata.load_uvfits(&#39;../data/M87_230GHz_40uas.uvfits&#39;)</span>
<span class="c1">#     obs_ngeht.add_scans()</span>
<span class="c1">#     obs_ngeht = obs_ngeht.avg_coherent(0,scan_avg=True)</span>
<span class="c1">#     obs_ngeht = obs_ngeht.add_fractional_noise(0.01)</span>
<span class="c1">#     #</span>
<span class="c1">#     obs = obs_ngeht.flag_sites([&#39;ALMA&#39;,&#39;APEX&#39;,&#39;JCMT&#39;,&#39;SMA&#39;,&#39;SMT&#39;,&#39;LMT&#39;,&#39;SPT&#39;,&#39;PV&#39;,&#39;PDB&#39;,&#39;KP&#39;])</span>


<span class="c1">#     obslist = [obs,obs_ngeht]</span>
<span class="c1">#     labels = [&#39;ngEHT w/o EHT&#39;,&#39;Full ngEHT&#39;]</span>
    
    
<span class="c1">#     # Choose a default image</span>
<span class="c1">#     p = np.zeros(ff.size)</span>
<span class="c1">#     rad2uas = 3600e6*180/np.pi</span>
<span class="c1">#     for j in range(ff1.npx) :</span>
<span class="c1">#         for i in range(ff1.npx) :</span>
<span class="c1">#             p[i+ff1.npx*j] =  -((ff1.xcp[i,j]-5.0/rad2uas)**2+ff1.ycp[i,j]**2)*rad2uas**2/(2.0*25.0**2) + np.log( 1.0/( 2.0*np.pi * (25.0/rad2uas)**2 ) )</span>
<span class="c1">#     p[-5] = 0.2</span>
<span class="c1">#     p[-4] = 40</span>
<span class="c1">#     p[-3] = 2</span>
<span class="c1">#     p[-2] = 0</span>
<span class="c1">#     p[-1] = 0</span>
<span class="c1">#     p = np.array(p)</span>

<span class="c1">#     # 1D Diameter</span>
<span class="c1">#     plot_1d_forecast(ff,p,ff.size-4,obslist,labels=labels)</span>
<span class="c1">#     plt.savefig(&#39;ring_forecast_1d.png&#39;,dpi=300)</span>

<span class="c1">#     # 2D diameter vs width</span>
<span class="c1">#     plot_2d_forecast(ff,p,ff.size-4,ff.size-3,obslist,labels=labels)</span>
<span class="c1">#     plt.savefig(&#39;ring_forecast_2d.png&#39;,dpi=300)</span>

<span class="c1">#     # Triangle</span>
<span class="c1">#     plist = np.arange(len(p)-5,len(p))</span>
<span class="c1">#     plot_triangle_forecast(ff,p,plist,obslist,labels=labels)</span>
<span class="c1">#     plt.savefig(&#39;ring_forecast_tri.png&#39;,dpi=300)</span>
    
<span class="c1">#     # plt.show()</span>

</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Avery E. Broderick.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            LINK_SUFFIX:'.html', 
            HAS_SOURCE: 'true'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>